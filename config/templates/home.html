{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Task Manager</title>
<link rel="stylesheet" href="{% static 'style.css' %}">
<style>

body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: #0a0f2b;
    color: #e0e0ff;
}


.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 30px;
    background: #111740;
    box-shadow: 0 0 20px #00f0ff;
    position: sticky;
    top: 0;
    z-index: 100;
}


.navbar .brand {
    font-size: 1.5em;
    font-weight: bold;
}

.navbar .right {
    display: flex;
    align-items: center;
    gap: 15px;
}

.navbar .switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.navbar .switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.navbar .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0;
    right: 0; bottom: 0;
    background-color: #888;
    transition: .4s;
    border-radius: 34px;
}

.navbar .slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: #fff;
    transition: .4s;
    border-radius: 50%;
}

.navbar input:checked + .slider {
    background-color: #00f0ff;
}

.navbar input:checked + .slider:before {
    transform: translateX(26px);
}

.navbar button.logout-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    background: #1e2b5b;
    color: #fff;
    cursor: pointer;
    transition: 0.3s;
    box-shadow: 0 0 10px #00f0ff;
}

.navbar button.logout-btn:hover {
    background: #00f0ff;
    color: #000;
    box-shadow: 0 0 20px #00f0ff;
}


.home-container {
    max-width: 900px;
    margin: 40px auto;
    padding: 30px;
    background: rgba(10,15,43,0.8);
    border-radius: 15px;
    box-shadow: 0 0 20px #1e2b5b;
}


form#task-form {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
}

form input, form select {
    flex: 1 1 200px;
    padding: 10px;
    border-radius: 8px;
    border: none;
    outline: none;
    background: rgba(255,255,255,0.05);
    color: #ffffff;
    transition: 0.3s;
}

form input::placeholder {
    color: #aaa;
}

form input:focus, form select:focus {
    box-shadow: 0 0 10px #00f0ff;
}


form button {
    flex-basis: 100%;
    max-width: 200px;
    margin: 0 auto;
    padding: 12px;
    border-radius: 8px;
    border: none;
    background: #1e2b5b;
    color: #ffffff;
    cursor: pointer;
    box-shadow: 0 0 10px #00f0ff;
    transition: 0.3s;
}

form button:hover {
    background: #00f0ff;
    color: #000;
    box-shadow: 0 0 20px #00f0ff;
}

.task {
    border: 1px solid #00f0ff;
    padding: 15px;
    margin: 10px 0;
    border-radius: 12px;
    background: rgba(0,0,0,0.3);
    transition: all 0.3s ease;
    opacity: 0;
    transform: translateY(-10px);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.task.completed {
    text-decoration: line-through;
    opacity: 0.6;
    background: rgba(0,255,255,0.1);
}

.task.show {
    opacity: 1;
    transform: translateY(0);
    animation: fadeIn 0.3s forwards;
}

.task-info {
    flex: 1;
    padding-right: 20px;
}

.task button {
    margin-left: 5px;
    padding: 6px 12px;
    border-radius: 8px;
    border: none;
    background: #1e2b5b;
    color: #ffffff;
    cursor: pointer;
    transition: 0.3s;
    box-shadow: 0 0 5px #00f0ff;
}

.task button:hover {
    background: #00f0ff;
    color: #000;
    box-shadow: 0 0 10px #00f0ff;
}


.progress-bar {
    width: 100%;
    background: rgba(0,0,0,0.3);
    height: 20px;
    border-radius: 10px;
    overflow: hidden;
    margin-top: 15px;
    box-shadow: 0 0 10px #00f0ff inset;
}

.progress {
    background: #00f0ff;
    height: 100%;
    width: 0%;
    transition: width 0.5s ease;
    border-radius: 10px;
}


footer {
    text-align: center;
    padding: 15px;
    background: #111740;
    margin-top: 30px;
    border-top: 1px solid #00f0ff;
    box-shadow: 0 0 10px #00f0ff inset;
}

@keyframes fadeIn {
    0% {opacity: 0; transform: translateY(-10px);}
    100% {opacity: 1; transform: translateY(0);}
}
</style>
</head>
<body>

<div class="navbar">
    <div class="brand">Task Manager App</div>
    <div class="right">
        <label class="switch">
            <input type="checkbox" id="toggle-theme-switch">
            <span class="slider"></span>
        </label>
        <div id="current-time"></div>
        <button class="logout-btn" id="logout-btn">Logout</button>
    </div>
</div>

<div class="home-container">
    <h2>Add Task</h2>
    <form id="task-form">
        <input type="text" name="title" placeholder="Task title" required>
        <input type="text" name="description" placeholder="Description">
        <input type="date" name="due_date">
        <input type="time" name="due_time">
        <select name="priority">
            <option value="Low">Low</option>
            <option value="Medium" selected>Medium</option>
            <option value="High">High</option>
        </select>
        <button type="submit">Add Task</button>
    </form>

    <h2>Tasks</h2>
    <div id="tasks-list"></div>

    <h3>Progress</h3>
    <div class="progress-bar">
        <div class="progress" id="progress"></div>
    </div>
</div>


<footer>
    &copy; 2026 Task Manager App. All rights reserved.
</footer>

<script>

const body = document.body;
document.getElementById('toggle-theme-switch').onclick = () => {
    body.classList.toggle('light-theme');
    body.classList.toggle('dark-theme');
}


function updateTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    document.getElementById('current-time').innerText = timeStr;
}
setInterval(updateTime, 1000);
updateTime();


const API_URL = "/api/tasks/";
const csrftoken = "{{ csrf_token }}";


function fetchTasks() {
    fetch(API_URL, { headers:{'X-CSRFToken': csrftoken}})
    .then(res => res.status===401 ? window.location.href='/login/' : res.json())
    .then(data => {
        const container = document.getElementById("tasks-list");
        container.innerHTML = '';
        let completed = 0;

        data.forEach(task => {
            if(task.completed) completed++;
            const div = document.createElement('div');
            div.className = 'task ' + (task.completed?'completed':'');
            div.innerHTML = `
                <div class="task-info">
                    <strong>${task.title}</strong> - ${task.priority} - Due: ${task.due_date || 'N/A'} ${task.due_time || ''}
                    <p>${task.description || ''}</p>
                </div>
                <div>
                    <button onclick="toggleComplete(${task.id}, ${task.completed})">${task.completed?'Pending':'Complete'}</button>
                    <button onclick="deleteTask(${task.id})">Delete</button>
                </div>
            `;
            container.appendChild(div);
            setTimeout(()=>div.classList.add('show'),50);
        });

        document.getElementById('progress').style.width = data.length?Math.round((completed/data.length)*100)+'%':'0%';
    });
}


function addTask(e){
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target));
    fetch(API_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json','X-CSRFToken':csrftoken},
        body: JSON.stringify(data)
    }).then(()=>{ e.target.reset(); fetchTasks(); });
}


function deleteTask(id){
    fetch(API_URL+id+'/',{method:'DELETE', headers:{'X-CSRFToken':csrftoken}})
    .then(fetchTasks);
}

function toggleComplete(id, completed){
    fetch(API_URL+id+'/',{
        method:'PUT',
        headers:{'Content-Type':'application/json','X-CSRFToken':csrftoken},
        body: JSON.stringify({completed:!completed})
    }).then(fetchTasks);
}

document.getElementById('logout-btn').onclick = ()=> window.location.href='/accounts/logout/';


document.getElementById('task-form').addEventListener('submit', addTask);

fetchTasks();
</script>
</body>
</html>
